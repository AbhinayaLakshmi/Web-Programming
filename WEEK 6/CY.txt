
CHALLENGE YOURSELF

// /controllers/customerController.js

const Customer=require('../models/customerModel');
exports.createCustomer=async(req,res,next) => {
    try{
        const {name,email,phone,isActive}=req.body;
        if(!name || !email || !phone){
            return res.status(404).json({message:'Name, email, and phone are required'});
        }
        const newCustomer=new Customer({name,email,phone,isActive});
        const savedCustomer=await newCustomer.save();
        res.status(201).json(savedCustomer);
    }catch(err){
        next(err);
    }
};
exports.getAllCustomers=async(req,res,next) => {
    try{
        const customers=await Customer.find();
        res.status(200).json(customers);
    }catch(err) {
        next(err);
    }
};
exports.updateCustomer=async(req,res,next) => {
    try{
        const {id}=req.params;
        const {name,email,phone,isActive}=req.body;
        if(!name || !email || !phone) {
            return res.status(404).json({message: 'Name, email, and phone are required to update the customer'});
        }
        const updated=await Customer.findByIdAndUpdate(
            id,
            {name,email,phone,isActive},
            {new:true}
        );
        if(!updated){
            return res.status(404).json({message:'Customer not found'});
        }
        res.status(200).json(updated);
    }catch(err){
        next(err);
    }
};

// /middlewares/errorHandler.js

const errorHandler=(err,req,res,next) => {
    console.error(err.stack);
    const status=res.statusCode !== 200 ? res.statusCode : 500;
    res.status(status).json({
        message:err.message,
        ...(process.env.NODE_ENV === 'development' && {stack:err.stack})
    });
};
module.exports=errorHandler;

// /models/customerModel.js

const mongoose=require('mongoose');
const customerSchema=new mongoose.Schema({
    name:{type:String,required:true},
    email:{type:String,required:true},
    phone:{type:String,required:true},
    isActive:{type:Boolean,default:true}
});
module.exports=mongoose.model('Customer',customerSchema);

// /routers/customerRoutes.js

const express=require('express');
const router=express.Router();
const customerController=require('../controllers/customerController');
router.post('/customers',customerController.createCustomer);
router.get('/customers',customerController.getAllCustomers);
router.put('/customers/:id',customerController.updateCustomer);
module.exports=router;

// index.js

const express=require('express');
const mongoose=require('mongoose');
const customerRoutes=require('./routers/customerRoutes');
const errorHandler=require('./middlewares/errorHandler');
const app=express();
const PORT=8080;
app.use(express.json());
mongoose.connect('mongodb://127.0.0.1:27017/customersDB', {
    useNewUrlParser:true,
    useUnifiedTopology:true
})
.then(() => console.log('MongoDB connected'))
.catch(err => console.error('MongoDB connection error:',err));
app.use('/customers',customerRoutes);
app.use(errorHandler);
app.listen(PORT, () => {
    console.log(`Server running on http://localhost:${PORT}`);
});


